<ui:FluentWindow 
    x:Class="SyncFlow.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:SyncFlow.ViewModels"
    Title="SyncFlow" 
    Height="700" 
    Width="1000"
    MinHeight="500" 
    MinWidth="800"
    WindowStartupLocation="CenterScreen"
    Background="{DynamicResource WindowBackground}"
    ExtendsContentIntoTitleBar="True"
    WindowCornerPreference="Round"
    WindowBackdropType="Mica">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <ui:TitleBar
            Grid.Row="0"
            Title="SyncFlow"
            ShowMinimize="True"
            ShowMaximize="True"
            ShowClose="True">
        </ui:TitleBar>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header Section -->
            <Grid Grid.Row="0" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock 
                        Text="Transfer Profiles"
                        FontSize="32"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource ForegroundPrimary}"/>
                    <TextBlock 
                        Text="Manage your file transfer configurations"
                        FontSize="14"
                        Foreground="{DynamicResource ForegroundSecondary}"
                        Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button 
                        Content="➕ New Profile"
                        Command="{Binding CreateProfileCommand}"
                        Background="{DynamicResource ButtonBackground}"
                        Foreground="{DynamicResource ButtonForeground}"
                        BorderBrush="{DynamicResource AccentPrimary}"
                        Padding="16,10"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Margin="0,0,8,0"/>
                    
                    <Button 
                        Content="⚙️"
                        Command="{Binding OpenSettingsCommand}"
                        Background="{DynamicResource ButtonSecondaryBackground}"
                        Foreground="{DynamicResource ForegroundPrimary}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        Padding="12,10"
                        FontSize="16"
                        ToolTip="Settings"/>
                </StackPanel>
            </Grid>

            <!-- Profiles Content Area -->
            <ScrollViewer 
                Grid.Row="1" 
                VerticalScrollBarVisibility="Auto"
                HorizontalScrollBarVisibility="Disabled">
                
                <Grid>
                    <!-- Welcome Message (No Profiles) -->
                    <Border
                        Visibility="{Binding HasNoProfiles, Converter={StaticResource BoolToVisibility}}"
                        Background="{DynamicResource CardBackground}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="2"
                        CornerRadius="12"
                        Padding="48"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        MaxWidth="500">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock 
                                Text="📁"
                                FontSize="64"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,16"/>
                            <TextBlock 
                                Text="Welcome to SyncFlow"
                                FontSize="28"
                                FontWeight="Bold"
                                HorizontalAlignment="Center"
                                Foreground="{DynamicResource ForegroundPrimary}"
                                Margin="0,0,0,8"/>
                            <TextBlock 
                                Text="Get started by creating your first transfer profile"
                                FontSize="16"
                                HorizontalAlignment="Center"
                                TextAlignment="Center"
                                Foreground="{DynamicResource ForegroundSecondary}"
                                TextWrapping="Wrap"
                                Margin="0,0,0,24"/>
                            <Button
                                Content="➕ Create Your First Profile"
                                Command="{Binding CreateProfileCommand}"
                                Background="{DynamicResource ButtonBackground}"
                                Foreground="{DynamicResource ButtonForeground}"
                                BorderBrush="{DynamicResource AccentPrimary}"
                                Padding="20,12"
                                FontSize="16"
                                FontWeight="SemiBold"
                                HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Profile List -->
                    <ItemsControl 
                        ItemsSource="{Binding Profiles}"
                        Visibility="{Binding HasProfiles, Converter={StaticResource BoolToVisibility}}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:ProfileViewModel}">
                                <!-- Profile Card - Different states handled by DataTriggers -->
                                <Border
                                    Background="{DynamicResource CardBackground}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    Padding="24"
                                    Margin="0,0,0,16">
                                    
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- IDLE STATE -->
                                        <Grid Grid.Row="0" Visibility="{Binding IsIdle, Converter={StaticResource BoolToVisibility}}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Profile Info -->
                                            <StackPanel Grid.Column="0">
                                                <TextBlock 
                                                    Text="{Binding ProfileName}"
                                                    FontSize="20"
                                                    FontWeight="SemiBold"
                                                    Foreground="{DynamicResource ForegroundPrimary}"/>
                                                <TextBlock 
                                                    Text="{Binding DestinationFolder}"
                                                    FontSize="14"
                                                    Foreground="{DynamicResource ForegroundSecondary}"
                                                    Margin="0,4,0,0"
                                                    TextTrimming="CharacterEllipsis"/>
                                                <TextBlock 
                                                    Text="{Binding StatusMessage}"
                                                    FontSize="12"
                                                    Foreground="{DynamicResource ForegroundTertiary}"
                                                    Margin="0,8,0,0"/>
                                            </StackPanel>

                                            <!-- Action Buttons -->
                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                <Button
                                                    Content="▶️ Run"
                                                    Command="{Binding RunTransferCommand}"
                                                    Background="{DynamicResource ButtonBackground}"
                                                    Foreground="{DynamicResource ButtonForeground}"
                                                    BorderBrush="{DynamicResource AccentPrimary}"
                                                    Padding="16,8"
                                                    FontSize="14"
                                                    Margin="0,0,8,0"/>
                                                <Button
                                                    Content="✏️"
                                                    Command="{Binding EditCommand}"
                                                    Background="{DynamicResource ButtonSecondaryBackground}"
                                                    Foreground="{DynamicResource ForegroundPrimary}"
                                                    BorderBrush="{DynamicResource BorderBrush}"
                                                    Padding="12,8"
                                                    FontSize="14"
                                                    ToolTip="Edit Profile"
                                                    Margin="0,0,8,0"/>
                                                <Button
                                                    Content="🗑️"
                                                    Command="{Binding DeleteCommand}"
                                                    Background="{DynamicResource ButtonDangerBackground}"
                                                    Foreground="{DynamicResource ButtonForeground}"
                                                    BorderBrush="{DynamicResource ButtonDangerBackground}"
                                                    Padding="12,8"
                                                    FontSize="14"
                                                    ToolTip="Delete Profile"/>
                                            </StackPanel>
                                        </Grid>

                                        <!-- RUNNING STATE -->
                                        <Grid Grid.Row="0" Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibility}}">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Header with Cancel Button -->
                                            <Grid Grid.Row="0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock 
                                                    Grid.Column="0"
                                                    Text="{Binding ProfileName}"
                                                    FontSize="20"
                                                    FontWeight="SemiBold"
                                                    Foreground="{DynamicResource ForegroundPrimary}"/>

                                                <Button
                                                    Grid.Column="1"
                                                    Content="⛔ Cancel"
                                                    Command="{Binding CancelTransferCommand}"
                                                    Background="{DynamicResource ButtonDangerBackground}"
                                                    Foreground="{DynamicResource ButtonForeground}"
                                                    Padding="12,6"
                                                    FontSize="14"/>
                                            </Grid>

                                            <!-- Current File & Status -->
                                            <Grid Grid.Row="1" Margin="0,12,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock 
                                                    Grid.Column="0"
                                                    Text="{Binding CurrentFile}"
                                                    FontSize="14"
                                                    Foreground="{DynamicResource ForegroundSecondary}"
                                                    TextTrimming="CharacterEllipsis"/>

                                                <TextBlock 
                                                    Grid.Column="1"
                                                    Text="{Binding ProgressText}"
                                                    FontSize="14"
                                                    Foreground="{DynamicResource ForegroundSecondary}"
                                                    Margin="8,0,0,0"/>
                                            </Grid>

                                            <!-- Progress Bar -->
                                            <ProgressBar
                                                Grid.Row="2"
                                                Value="{Binding ProgressPercentage, Mode=OneWay}"
                                                Maximum="100"
                                                Height="8"
                                                Margin="0,8,0,0"
                                                Background="{DynamicResource ProgressBarBackground}"
                                                Foreground="{DynamicResource ProgressBarForeground}"
                                                BorderThickness="0"/>

                                            <!-- Transfer Stats -->
                                            <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,8,0,0">
                                                <TextBlock 
                                                    Text="{Binding TransferSpeedText}"
                                                    FontSize="12"
                                                    Foreground="{DynamicResource ForegroundTertiary}"
                                                    Margin="0,0,16,0"/>
                                                <TextBlock 
                                                    Text="{Binding TimeElapsedText}"
                                                    FontSize="12"
                                                    Foreground="{DynamicResource ForegroundTertiary}"
                                                    Margin="0,0,16,0"/>
                                                <TextBlock 
                                                    Text="{Binding StatusMessage}"
                                                    FontSize="12"
                                                    Foreground="{DynamicResource ForegroundTertiary}"/>
                                            </StackPanel>
                                        </Grid>

                                        <!-- COMPLETED STATE -->
                                        <Grid Grid.Row="0" Visibility="{Binding IsCompleted, Converter={StaticResource BoolToVisibility}}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Success Icon -->
                                            <Border 
                                                Grid.Column="0"
                                                Background="{DynamicResource SuccessColor}"
                                                CornerRadius="20"
                                                Width="40"
                                                Height="40"
                                                VerticalAlignment="Center"
                                                Margin="0,0,16,0">
                                                <TextBlock 
                                                    Text="✓"
                                                    FontSize="24"
                                                    FontWeight="Bold"
                                                    Foreground="White"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"/>
                                            </Border>

                                            <!-- Success Message -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock 
                                                    Text="{Binding ProfileName}"
                                                    FontSize="20"
                                                    FontWeight="SemiBold"
                                                    Foreground="{DynamicResource ForegroundPrimary}"/>
                                                <TextBlock 
                                                    Text="{Binding StatusMessage}"
                                                    FontSize="14"
                                                    Foreground="{DynamicResource SuccessColor}"
                                                    FontWeight="SemiBold"
                                                    Margin="0,4,0,0"/>
                                            </StackPanel>

                                            <!-- Reset Button -->
                                            <Button
                                                Grid.Column="2"
                                                Content="↺ Reset"
                                                Command="{Binding ResetCommand}"
                                                Background="{DynamicResource ButtonSecondaryBackground}"
                                                Foreground="{DynamicResource ForegroundPrimary}"
                                                Padding="12,8"
                                                FontSize="14"/>
                                        </Grid>

                                        <!-- FAILED STATE -->
                                        <Grid Grid.Row="0" Visibility="{Binding IsFailed, Converter={StaticResource BoolToVisibility}}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Error Icon -->
                                            <Border 
                                                Grid.Column="0"
                                                Background="{DynamicResource ErrorColor}"
                                                CornerRadius="20"
                                                Width="40"
                                                Height="40"
                                                VerticalAlignment="Center"
                                                Margin="0,0,16,0">
                                                <TextBlock 
                                                    Text="✕"
                                                    FontSize="24"
                                                    FontWeight="Bold"
                                                    Foreground="White"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"/>
                                            </Border>

                                            <!-- Error Message -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock 
                                                    Text="{Binding ProfileName}"
                                                    FontSize="20"
                                                    FontWeight="SemiBold"
                                                    Foreground="{DynamicResource ForegroundPrimary}"/>
                                                <TextBlock 
                                                    Text="{Binding StatusMessage}"
                                                    FontSize="14"
                                                    Foreground="{DynamicResource ErrorColor}"
                                                    FontWeight="SemiBold"
                                                    Margin="0,4,0,0"/>
                                                <TextBlock 
                                                    Text="{Binding ErrorMessage}"
                                                    FontSize="12"
                                                    Foreground="{DynamicResource ForegroundSecondary}"
                                                    TextWrapping="Wrap"
                                                    Margin="0,4,0,0"/>
                                            </StackPanel>

                                            <!-- Retry Button -->
                                            <Button
                                                Grid.Column="2"
                                                Content="↺ Retry"
                                                Command="{Binding RunTransferCommand}"
                                                Background="{DynamicResource ButtonBackground}"
                                                Foreground="{DynamicResource ButtonForeground}"
                                                Padding="12,8"
                                                FontSize="14"/>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </ScrollViewer>
        </Grid>
    </Grid>
</ui:FluentWindow>
